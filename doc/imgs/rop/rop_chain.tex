\documentclass[../tfg.tex]{subfiles}

\begin{document}

\begin{tikzpicture}
[gadget/.style={rectangle, fill=cyan!20},
 stacknode/.style={rectangle, text centered, minimum width=3cm, minimum height=0.5cm, fill=red!20}]

    \node (g1) at (0, -1) [gadget] {\texttt{xor rax, rax; ret}};
    \node (g2) at (1, 1) [gadget] {\texttt{mov 1, eax; ret}};
    \node (g3) at (-3.5, 1.5) [gadget] {\texttt{syscall; ret}};
    \node (g4) at (-4, -2) [gadget] {\texttt{pop rdi; ret}};
    \node (g5) at(-4, 0) [gadget] {\texttt{mov 0, rsi; ret}};

    %addresses
    \node (g1addr) [left=0cm of g1.north west] {\texttt{0x4045c:}};
    \node (g2addr) [left=0cm of g2.north west] {\texttt{0xf0fee:}};
    \node (g3addr) [left=0cm of g3.north west] {\texttt{0x4a0f:}};
    \node (g4addr) [left=0cm of g4.north west] {\texttt{0x75a0:}};
    \node (g5addr) [left=0cm of g5.north west] {\texttt{0x1007f:}};

    %stack
    \node (buffer) at (5, 1.5) [stacknode, minimum height=1cm] {\texttt{buffer}};
    \node (rbp) [stacknode, below=0cm of buffer.south] {\texttt{rbp}};
    \node (c1) [stacknode, below=0cm of rbp.south] {\texttt{0x4045c}};
    \node (c2) [stacknode, below=0cm of c1.south] {\texttt{0xf0fee}};
    \node (c3) [stacknode, below=0cm of c2.south] {\texttt{0x75a0}};
    \node (c4) [stacknode, below=0cm of c3.south] {\texttt{0x7fffffff5e70}};
    \node (c5) [stacknode, below=0cm of c4.south] {\texttt{0x1007f}};
    \node (c6) [stacknode, below=0cm of c5.south] {\texttt{0x4a0f}};

    %arcs
    \path[->] (c1.west) edge [bend right] (g1.east);
    \path[->] (g1.north) edge [bend right] (g2.south);
    \path[->] (g2.west) edge [bend right] (g4.north east);
    \path[->] (g4.north) edge [bend left] (g5.south);
    \path[->] (g5.north) edge [bend left] (g3.south);

    %tags
    \draw[rounded corners] (-7.5, 2.5) rectangle (3, -3) {};
    \node (text) at (0, -2.5) {\texttt{.text}};
    \node (stack) [above=0cm of buffer.north] {Stack};

\end{tikzpicture}

\end{document}
