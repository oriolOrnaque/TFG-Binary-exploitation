\documentclass[../tfg.tex]{subfiles}

\begin{document}

\begin{minipage}[c]{0.4\linewidth}
\begin{tikzpicture}
[remember picture, stacknode/.style={rectangle, text centered, minimum width=2.7cm, minimum height=0.7cm, fill=red!20}]

    \node (buffer) [stacknode, minimum height=2cm] {\texttt{buffer}};
    \node (ebp) [stacknode, below=0cm of buffer.south] {\texttt{rbp}};
    \node (eip) [stacknode, below=0cm of ebp.south] {\texttt{rax} gadget};
    \node (command) [stacknode, below=0cm of eip.south] {\texttt{syscall} gadget};
    \node (sigframe) [stacknode, below=0cm of command.south, minimum height=4cm, fill=cyan!20] {signal frame};

\end{tikzpicture}
\end{minipage}
\begin{minipage}[c]{0.55\linewidth}
\begin{tikzpicture}
[remember picture, stacknode/.style={minimum width=3.5cm, fill=cyan!20, minimum height=0.5cm}]

    % first column
    \node (sigreturn) [stacknode] {\texttt{rt\_sigreturn}};
    \node (uc) [stacknode, below=0cm of sigreturn.south] {\texttt{\&uc}};
    \node (ssflags) [stacknode, below=0cm of uc.south] {\texttt{uc\_stack.ss\_flags}};
    \node (r8) [stacknode, below=0cm of ssflags.south] {\texttt{r8}};
    \node (r10) [stacknode, below=0cm of r8.south] {\texttt{r10}};
    \node (r12) [stacknode, below=0cm of r10.south] {\texttt{r12}};
    \node (r14) [stacknode, below=0cm of r12.south] {\texttt{r14}};
    \node (rdi) [stacknode, below=0cm of r14.south] {\texttt{rdi}};
    \node (rbp) [stacknode, below=0cm of rdi.south] {\texttt{rbp}};
    \node (rdx) [stacknode, below=0cm of rbp.south] {\texttt{rdx}};
    \node (rcx) [stacknode, below=0cm of rdx.south] {\texttt{rcx}};
    \node (rip) [stacknode, below=0cm of rcx.south] {\texttt{rip}};
    \node (segments) [stacknode, below=0cm of rip.south] {\texttt{cs/gs/fs/ss}};
    \node (trapno) [stacknode, below=0cm of segments.south] {\texttt{trapno}};
    \node (cr2) [stacknode, below=0cm of trapno.south] {\texttt{cr2}};
    \node (reserved) [stacknode, below=0cm of cr2.south] {\texttt{\_\_reserved}};

    \node (x00) [anchor=east, left=0cm of sigreturn.west] {0x00};
    \node (x10) [anchor=east, left=0cm of uc.west] {0x10};
    \node (x20) [anchor=east, left=0cm of ssflags.west] {0x20};
    \node (x30) [anchor=east, left=0cm of r8.west] {0x30};
    \node (x40) [anchor=east, left=0cm of r10.west] {0x40};
    \node (x50) [anchor=east, left=0cm of r12.west] {0x50};
    \node (x60) [anchor=east, left=0cm of r14.west] {0x60};
    \node (x70) [anchor=east, left=0cm of rdi.west] {0x70};
    \node (x80) [anchor=east, left=0cm of rbp.west] {0x80};
    \node (x90) [anchor=east, left=0cm of rdx.west] {0x90};
    \node (0xa0) [anchor=east, left=0cm of rcx.west] {0xa0};
    \node (0xb0) [anchor=east, left=0cm of rip.west] {0xb0};
    \node (0xc0) [anchor=east, left=0cm of segments.west] {0xc0};
    \node (0xd0) [anchor=east, left=0cm of trapno.west] {0xd0};
    \node (0xe0) [anchor=east, left=0cm of cr2.west] {0xe0};
    \node (0xf0) [anchor=east, left=0cm of reserved.west] {0xf0};

    % second column
    \node (ucflags) [stacknode, right=0cm of sigreturn.east] {\texttt{uc\_flags}};
    \node (sssp) [stacknode, below=0cm of ucflags.south] {\texttt{uc\_stack.ss\_sp}};
    \node (sssize) [stacknode, below=0cm of sssp.south] {\texttt{uc\_stack.ss\_size}};
    \node (r9) [stacknode, below=0cm of sssize.south] {\texttt{r9}};
    \node (r11) [stacknode, below=0cm of r9.south] {\texttt{r11}};
    \node (r13) [stacknode, below=0cm of r11.south] {\texttt{r13}};
    \node (r15) [stacknode, below=0cm of r13.south] {\texttt{r15}};
    \node (rsi) [stacknode, below=0cm of r15.south] {\texttt{rsi}};
    \node (rbx) [stacknode, below=0cm of rsi.south] {\texttt{rbx}};
    \node (rax) [stacknode, below=0cm of rbx.south] {\texttt{rax}};
    \node (rsp) [stacknode, below=0cm of rax.south] {\texttt{rsp}};
    \node (eflags) [stacknode, below=0cm of rsp.south] {\texttt{eflags}};
    \node (err) [stacknode, below=0cm of eflags.south] {\texttt{err}};
    \node (oldmask) [stacknode, below=0cm of err.south] {\texttt{oldmask}};
    \node (fpstate) [stacknode, below=0cm of oldmask.south] {\texttt{\&fpstate}};
    \node (sigmask) [stacknode, below=0cm of fpstate.south] {\texttt{sigmask}};

\end{tikzpicture}

\end{minipage}

\begin{tikzpicture}
    [remember picture, overlay]

    \draw (sigframe.north east) -- (sigreturn.north west);
    \draw (sigframe.south east) -- (reserved.south west);
\end{tikzpicture}

\end{document}

