\documentclass[../tfg.tex]{subfiles}

\begin{document}

\begin{lstlisting}
int arg1, arg2, arg4;
char* arg3 = "Hello world";
printf("%x %d %s %n\n", arg1, arg2, arg3, &arg4);
\end{lstlisting}

\begin{tikzpicture}
[stacknode/.style = {rectangle, text centered, minimum width=4cm, minimum height=0.5cm}]

    \node (locals) [stacknode, fill=red!10] {locals};
    \node (rbp) [stacknode, below=0 of locals.south, fill=red!20] {\texttt{rbp}};
    \node (rip) [stacknode, below=0 of rbp.south, fill=red!30] {\texttt{rip}};
    \node(bufferaddr) [stacknode, below=0 of rip.south, fill=red!40] {Address of format string};
    \node (arg1) [stacknode, below=0 of bufferaddr.south, fill=red!50] {arg1};
    \node (arg2) [stacknode, below=0 of arg1.south, fill=red!50] {arg2};
    \node (arg3) [stacknode, below=0 of arg2.south, fill=red!50] {arg3};
    \node (arg4) [stacknode, below=0 of arg3.south, fill=red!50] {Address of arg4};

    \node (ptr) [left=2cm of arg1.west, text width=3cm] {Internal pointer from where the format function will start matching arguments with the format string};

    \node (low) [left=0cm of locals.west] {\texttt{0x0...0}};
    \node (high) [left=0cm of arg4.west] {\texttt{0xf...f}};

    \draw [-{Latex[round]}] (ptr.east) -- (arg1.west);
    \draw [-{Latex[round]}] (ptr.east) -| (high.north);

\end{tikzpicture}

\end{document}
