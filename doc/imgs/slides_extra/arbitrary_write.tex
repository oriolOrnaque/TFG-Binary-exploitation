\documentclass[../tfg.tex]{subfiles}

\begin{document}

\begin{minipage}[c]{0.49\linewidth}
\begin{lstlisting}[escapechar = @]
int main()
{
    int dummy;
    char buffer[] = 
        "AAAAAAAA %x@\tikz[remember picture] \node (strarg1) {};@ %x@\tikz[remember picture] \node (strarg2) {};@ %n@\tikz[remember picture] \node (strstr) {};@";

    printf(buffer, dummy);

    return 0;
}
\end{lstlisting}
\end{minipage}
\begin{minipage}[c]{0.49\linewidth}
\begin{tikzpicture}
[remember picture, stacknode/.style={rectangle, text centered, minimum width=3cm, minimum height=0.5cm}]

    \node (rbp) [stacknode, fill=red!20] {\texttt{rbp}};
    \node (rip) [stacknode, below=0 of rbp.south, fill=red!30] {\texttt{rip}};
    \node(bufferaddr) [stacknode, below=0 of rip.south, fill=red!40] {\texttt{buffer}'s address};
    \node (arg1) [stacknode, below=0 of bufferaddr.south, fill=red!50] {dummy};

    \node (dummy) [stacknode, below=0 of arg1.south, fill=cyan!20] {\texttt{dummy}};
    \node (buffer) [stacknode, below=0 of dummy.south, fill=cyan!40, minimum height=2cm] {\texttt{buffer}};
    \node (rbp2) [stacknode, below=0 of buffer.south, fill=cyan!50] {\texttt{rbp}};
    \node (rip2) [stacknode, below=0 of rbp2.south, fill=cyan!60] {\texttt{rip}};

    \node (printfframe) [stacknode, right=0 of bufferaddr.north east] {\texttt{printf}'s stack frame};
    \node (mainframe) [stacknode, right=0 of buffer.east] {\texttt{main}'s stack frame};

\end{tikzpicture}
\end{minipage}

\begin{tikzpicture}
    [remember picture, overlay]

    \node (addr) [below=0 of buffer.north, minimum width=3cm] {\texttt{0x41 0x41 ...}};

    \draw [-{Latex[round]}] (strarg1.south west) |- (arg1.west);
    \draw [-{Latex[round]}] (strarg2.south west) |- (dummy.west);
    \draw [-{Latex[round]}] (strstr.south west) |- (addr.west);
\end{tikzpicture}

\end{document}

